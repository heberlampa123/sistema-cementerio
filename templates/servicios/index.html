{% extends "base.html" %}
{% block title %}Servicios{% endblock %}

{% block content %}
<h3>Gestión de Servicios</h3>

<div class="btn-opciones d-flex justify-content-between align-items-center mb-2" style="gap: 10px;">
    <a href="{{ url_for('servicio.create') }}" class="btn btn-sm btn-success" title="Nuevo"
        style="display: flex; align-items: center; gap: 5px; padding: 8px;">
        <i class="bi bi-plus-circle"></i> Nuevo
    </a>
    <form method="get" action="{{ url_for('servicio.search')}}" class="d-flex align-items-center"
        style="max-width: 500px; gap: 5px;">
        <select name="q" class="form-select" style="width: 150px;" value="{{ query or '' }}">
            <option value="">Todos</option>
            <option value="En proceso" {% if estado=='En proceso' %}selected{% endif %}>En proceso</option>
            <option value="Finalizado" {% if estado=='Finalizado' %}selected{% endif %}>Finalizado</option>
            <option value="Cancelado" {% if estado=='Cancelado' %}selected{% endif %}>Cancelado</option>
        </select>
        <button type="submit" class="btn btn-primary">Buscar</button>
    </form>
</div>

<table id="AllTable" class="table table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Categoria</th>
            <th>Espacio</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Total</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for servicio in servicios %}
        <tr>
            <td>{{ servicio.id }}</td>
            <td>{{ servicio.usuario.username }}</td>
            <td>{{ servicio.tipo_servicio.tipo }}</td>
            <td>{{ servicio.asignacion.espacio.tipo }}</td>
            <td>{{ servicio.fecha.strftime('%d/%m/%Y') }}</td>
            <td><span class="badge bg-{{ 'success' if servicio.estado=='Finalizado' else 'warning' if servicio.estado=='En proceso' else 'secondary' }}">
                {{servicio.estado }}</span>
            </td>
            <td>{{ servicio.total | round(2) }}</td>
            <td class="text-center">
                <a href="{{ url_for('servicio.edit', id=servicio.id) }}" class="btn btn-warning btn-sm rounded-pill me-1">
                    <i class="bi bi-pencil-square"></i> Editar
                </a>
                <a href="{{ url_for('servicio.delete', id=servicio.id) }}" class="btn btn-danger btn-sm rounded-pill"
                    onclick="return confirm('¿Seguro que deseas eliminar este registro?');">
                    <i class="bi bi-trash3"></i> Eliminar
                </a>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="10" class="text-muted text-center">No hay registros.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<!-- Contenedor de paginación -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-end" id="pagination"></ul>
</nav>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
{% endblock %}